<div class="container">
  <form #candidateForm="ngForm" (ngSubmit)="save(candidateForm.value)">

    <h2 mat-subheader>{{candidate.id ? 'Edit' : 'Add'}} Candidate</h2>

    <mat-grid-list cols="{{isMobile() ? 1 : 2}}" rowHeight="450px" gutterSize="10px" class="content-grid">
      <mat-grid-tile>
        <mat-grid-tile-header> Fill candidate data:</mat-grid-tile-header>

        <mat-list class="mat-grid-content">
          <input type="hidden" name="href" [(ngModel)]="candidate.href">

          <mat-list-item>
            <mat-form-field>
              <input matInput placeholder="First Name" [(ngModel)]="candidate.firstName"
                     required name="firstName" #firstName>
            </mat-form-field>
          </mat-list-item>

          <mat-list-item>
            <mat-form-field>
              <input matInput placeholder="Last Name" [(ngModel)]="candidate.lastName"
                     required name="lastName" #lastName>
            </mat-form-field>
          </mat-list-item>

          <mat-list-item>
            <mat-form-field>
              <input matInput placeholder="Email" [(ngModel)]="candidate.email"
                     required email name="email" #email>
              <mat-error *ngIf="!email.valid">Not a valid email</mat-error>
            </mat-form-field>
          </mat-list-item>

          <mat-list-item>
            <mat-form-field>
              <input matInput placeholder="Position" [(ngModel)]="candidate.position"
                     required name="position" #position>
            </mat-form-field>
          </mat-list-item>
        </mat-list>
      </mat-grid-tile>

      <mat-grid-tile *ngIf="candidate.id != null">
        <mat-grid-tile-header> Manage attachments:</mat-grid-tile-header>

        <mat-table #table [dataSource]="attachmentsDS" class="attachment-table">

          <ng-container matColumnDef="icon">
            <mat-header-cell class="icon-column" *matHeaderCellDef></mat-header-cell>
            <mat-cell class="icon-column" *matCellDef="let attachment">
              <button mat-mini-fab
                      type="button"
                      color="secondary"
                      (click)="attachmentService.download(attachment.id)">
                <mat-icon>get_app</mat-icon>
              </button>
            </mat-cell>
          </ng-container>

          <ng-container matColumnDef="name">
            <mat-header-cell *matHeaderCellDef>NAME</mat-header-cell>
            <mat-cell class="id-column" *matCellDef="let attachment">{{attachment.name}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="date">
            <mat-header-cell class="upload-date-column" *matHeaderCellDef>UPLOAD DATE</mat-header-cell>
            <mat-cell class="upload-date-column" *matCellDef="let attachment">{{attachment.uploadDate | date}}</mat-cell>
          </ng-container>

          <ng-container matColumnDef="delete">
            <mat-header-cell class="icon-column" *matHeaderCellDef></mat-header-cell>
            <mat-cell class="icon-column" *matCellDef="let attachment">
              <button mat-mini-fab
                      type="button"
                      color="warn"
                      (click)="deleteAttachment(attachment)">
                <mat-icon>delete</mat-icon>
              </button>
            </mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="['icon','name', 'date', 'delete']"></mat-header-row>
          <mat-row *matRowDef="let rowData; columns: ['icon','name', 'date', 'delete']"></mat-row>
        </mat-table>

        <a mat-raised-button color="accent" class="add-attachment-button" (click)="attachmentInput.click()">
          <mat-icon>add</mat-icon>
        </a>
        <input hidden type="file" #attachmentInput (change)="uploadAttachment($event, candidate.id)" multiple/>
      </mat-grid-tile>

    </mat-grid-list>

    <div class="action-buttons">
      <button mat-raised-button color="primary" type="submit"
              [disabled]="!candidateForm.valid">Save
      </button>
      <button mat-raised-button color="secondary" mat-button routerLink="/candidate-list"
              type="button">Cancel
      </button>
    </div>
  </form>

</div>
